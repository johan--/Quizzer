<div [formGroup]="quiz">
    <div formArrayName="questions">
        <!-- Questions tree main buttons -->
        <div class="buttons">
            <button mat-stroked-button (click)="handleQuestions.addNew()" type="button">
                <mat-icon>add</mat-icon>Aggiungi domanda
            </button>
            <button mat-stroked-button (click)="nestedTreeControl.expandAll()" *ngIf="quiz.get('questions').length > 0" type="button">
                <mat-icon>expand_more</mat-icon>Espandi tutto
            </button>
            <button mat-stroked-button (click)="nestedTreeControl.collapseAll()" *ngIf="quiz.get('questions').length > 0" type="button">
                <mat-icon>expand_less</mat-icon>Chiudi tutto
            </button>
        </div>
        <!-- /Questions tree main buttons -->
        <!-- Questions tree -->
        <mat-tree [dataSource]="nestedDataSource" [treeControl]="nestedTreeControl" class="tree">
        
          <!-- QUESTION TEXT -->
          <mat-nested-tree-node *matTreeNodeDef="let node; when: hasNestedChild">
            <li class="tree-node-with-childs">
              <div class="mat-tree-node">
                <!-- Toggle button to expand node and show the answers -->
                <button mat-icon-button matTreeNodeToggle matTooltip="Mostra risposte">
                  <mat-icon class="mat-icon-rtl-mirror">
                    {{nestedTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                  </mat-icon>
                </button>
                <!-- /Toggle button to expand node and show the answers -->
                <!-- Element to edit question text -->
                <mat-form-field>
                  <mat-label>Domanda</mat-label>
                  <input matInput [formControl]="node.text" matTooltip="Inserisci il testo della tua domanda" required>
                  <mat-error *ngIf="node.text.invalid">{{node.text.errors.validText.text}}</mat-error>
                </mat-form-field>
                <!-- /Element to edit question text -->
                <!-- Button to add a new answer -->
                <button mat-icon-button (click)="handleQuestions.addNewAnswer(node)" matTooltip="Aggiungi una risposta"><mat-icon>add</mat-icon></button>
                <!-- /Button to add a new answer -->
                <!-- Button to remove this question -->
                <button mat-icon-button (click)="handleQuestions.remove(node.index)" matTooltip="Elimina questa domanda"><mat-icon>delete</mat-icon></button>
                <!-- /Button to remove this question -->
              </div>
              <!-- Nested nodes container -->
              <ul [class.tree-invisible]="!nestedTreeControl.isExpanded(node)" class="tree-node-childs">
                <ng-container matTreeNodeOutlet></ng-container>
              </ul>
              <!-- /Nested nodes container -->
            </li>
          </mat-nested-tree-node>
          <!-- /QUESTION TEXT -->


          <!-- QUESTION ANSWER -->
          <mat-nested-tree-node *matTreeNodeDef="let node">
            <li class="tree-node-child">
              <div class="mat-tree-node">

                <!-- Elements to show and edit answer text -->
                <mat-form-field>
                  <mat-label>Risposta</mat-label>
                  <input matInput [formControl]="node.text" matTooltip="Inserisci una possibile risposta" required>
                  <mat-error *ngIf="node.text.invalid">{{node.text.errors.validText.text}}</mat-error>
                </mat-form-field>
                <!-- /Elements to show and edit answer text -->
                <!-- Elements to show and edit answer value -->
                <ng-container *ngIf="quiz.get('settings').get('type').value === quizTypes.personalityQuiz">
                  <mat-form-field>
                    <mat-label>Valore</mat-label>
                    <input matInput [formControl]="node.value" (keyup)="handleAnswersValue.updateSuggestedValues(node.value.value)" [matAutocomplete]="auto" required matTooltip="Inserisci il valore della risposta">
                    <mat-autocomplete #auto="matAutocomplete">
                      <mat-option *ngFor="let option of handleAnswersValue.suggestedValues" [value]="option">
                        {{option}}
                      </mat-option>
                    </mat-autocomplete>
                    <mat-error *ngIf="node.value.invalid">{{node.value.errors.validAnswerValue.text}}</mat-error>
                  </mat-form-field>
                </ng-container>
                
                <mat-radio-group *ngIf="quiz.get('settings').get('type').value === quizTypes.trueorfalseQuiz" matInput [formControl]="node.value" matTooltip="Indica se la risposta Ã¨ vera o falsa">
                  <mat-radio-button [value]="true">VERO</mat-radio-button>
                  <mat-radio-button [value]="false">FALSO</mat-radio-button>
                </mat-radio-group>
                <!-- /Elements to show and edit answer value -->

                <!-- Button to remove this question -->
                <button mat-icon-button (click)="handleQuestions.removeAnswer(node.index, node.parentIndex)" matTooltip="Elimina questa risposta">
                  <mat-icon>delete</mat-icon>
                </button>
                <!-- /Button to remove this question -->

              </div>
              <!-- Nested nodes container -->
              <ul [class.tree-invisible]="!nestedTreeControl.isExpanded(node)">
                <ng-container matTreeNodeOutlet></ng-container>
              </ul>
              <!-- /Nested nodes container -->
            </li>
          </mat-nested-tree-node>
          <!-- /QUESTION ANSWER -->
        
        </mat-tree>              
        <!-- /Questions tree -->
    </div>
</div>